---
import Layout from "../../../layouts/Layout.astro";
import { ProfileRepository } from "../../../data/ProfileRepository";
import { InvitationRepository } from "../../../data/InvitationRepository";

const { user, event } = Astro.params;

const profileRepo = new ProfileRepository();
const profile = await profileRepo.getByUsername(user || "");

if (!profile) {
    return Astro.redirect("/404");
}

const invitationRepo = new InvitationRepository();
const invitation = await invitationRepo.getBySlugAndUser(
    event || "",
    profile.id,
);

if (!invitation) {
    // Render 404 specific to invitation
    Astro.response.status = 404;
}
---

<Layout
    title={invitation
        ? `Inivitacion - ${invitation.event_name}`
        : "Invitation Not Found"}
>
    {
        invitation ? (
            <div class="min-h-screen flex flex-col items-center justify-center bg-neutral-900 text-white p-4">
                <div class="max-w-md w-full bg-neutral-800 p-8 rounded-xl shadow-2xl border border-neutral-700 text-center">
                    <h1 class="text-3xl font-serif mb-2">
                        {invitation.event_name}
                    </h1>
                    <p class="text-neutral-400 mb-6 uppercase tracking-widest text-sm">
                        Invitation
                    </p>

                    <div class="space-y-4">
                        <div>
                            <p class="text-neutral-500 text-sm">When</p>
                            <p class="text-lg">
                                {new Date(
                                    invitation.event_date,
                                ).toLocaleString()}
                            </p>
                        </div>
                        <div>
                            <p class="text-neutral-500 text-sm">Where</p>
                            <p class="text-lg">{invitation.location}</p>
                        </div>
                    </div>

                    <p class="mt-8 text-neutral-300 italic">
                        "{invitation.description}"
                    </p>
                </div>
            </div>
        ) : (
            <div class="min-h-screen flex items-center justify-center bg-neutral-900 text-white">
                <h1 class="text-2xl">Invitation not found</h1>
            </div>
        )
    }
</Layout>
